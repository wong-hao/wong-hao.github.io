<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  
  
  <meta name="generator" content="Wowchemy 4.8.0 for Hugo">
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="HaoWong">

  
  
  
    
  
  <meta name="description" content="This is an code review and comments">

  
  <link rel="alternate" hreflang="en-us" href="https://haowong.com/project/codereview/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js" integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.css">

  




  
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KWMZJGQ');
</script>



  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hub0cb53550ede56fdccc60540659dbf84_11803_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hub0cb53550ede56fdccc60540659dbf84_11803_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://haowong.com/project/codereview/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Room of Requirement">
  <meta property="og:url" content="https://haowong.com/project/codereview/">
  <meta property="og:title" content="Code Review of Helper programs &#39;LoRa_PKT_FWD&#39; | Room of Requirement">
  <meta property="og:description" content="This is an code review and comments"><meta property="og:image" content="https://haowong.com/project/codereview/featured.png">
  <meta property="twitter:image" content="https://haowong.com/project/codereview/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-10-21T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-10-21T00:00:00&#43;00:00">
  

  


    









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://haowong.com/project/codereview/"
  },
  "headline": "Code Review of Helper programs 'LoRa_PKT_FWD'",
  
  "image": [
    "https://haowong.com/project/codereview/featured.png"
  ],
  
  "datePublished": "2020-10-21T00:00:00Z",
  "dateModified": "2020-10-21T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "HaoWong"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Room of Requirement",
    "logo": {
      "@type": "ImageObject",
      "url": "https://haowong.com/images/icon_hub0cb53550ede56fdccc60540659dbf84_11803_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "This is an code review and comments"
}
</script>

  

  


  


  





  <title>Code Review of Helper programs &#39;LoRa_PKT_FWD&#39; | Room of Requirement</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.wcDarkLightEnabled = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="/js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Room of Requirement</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Room of Requirement</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#accomplishments"><span>Accomplishments</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#father"><span>FATHER</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>



  <article class="article article-project">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Code Review of Helper programs &#39;LoRa_PKT_FWD&#39;</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Oct 21, 2020
  </span>
  

  

  

  
  
  
  <span class="middot-divider"></span>
  <a href="/project/codereview/#disqus_thread"></a>
  

  
  

</div>

  













<div class="btn-links mb-3">
  
  








  






  
  
    
  
<a class="btn btn-outline-primary my-1 mr-1" href="https://github.com/wong-hao/sx1302_hal" target="_blank" rel="noopener">
  Code
</a>














</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 226px;">
  <div style="position: relative">
    <img src="/project/codereview/featured_hu84dfb21f757a46b5302a4f6bf04b8da4_88406_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    <span class="article-header-caption">Photo by Chirpstack</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h1 id="1-json-configuration-file-globalconfig">1 JSON configuration file: global.config</h1>
<pre><code class="language-cpp">{
    &quot;SX130x_conf&quot;: { //parameters for the Lora concentrator board 
        &quot;spidev_path&quot;: &quot;/dev/spidev0.0&quot;,
        &quot;lorawan_public&quot;: true,
        &quot;clksrc&quot;: 0,
        &quot;antenna_gain&quot;: 0, /* antenna gain, in dBi */
        &quot;full_duplex&quot;: false,
        &quot;precision_timestamp&quot;: {
            &quot;enable&quot;: false,
            &quot;max_ts_metrics&quot;: 255,
            &quot;nb_symbols&quot;: 1
        },
        //两个SX1250
        &quot;radio_0&quot;: {
            &quot;enable&quot;: true, //包含了rx_enable与tx_enable
            &quot;type&quot;: &quot;SX1250&quot;,
            &quot;single_input_mode&quot;: true,
            &quot;freq&quot;: 470600000, //RX frequency
            &quot;rssi_offset&quot;: -207.0,
            &quot;rssi_tcomp&quot;: {&quot;coeff_a&quot;: 0, &quot;coeff_b&quot;: 0, &quot;coeff_c&quot;: 20.41, &quot;coeff_d&quot;: 2162.56, &quot;coeff_e&quot;: 0},
            &quot;tx_enable&quot;: true, 
            /* check TX frequency before trying to queue packet */ //thread_down
            &quot;tx_freq_min&quot;: 470000000, 
            &quot;tx_freq_max&quot;: 510000000,
            /* check TX power before trying to queue packet, send a warning if not supported */ //thread_down
            //tx_gain: transmit gain; lut: Look-Up-Table
            &quot;tx_gain_lut&quot;:[ 
                {&quot;rf_power&quot;: -6, &quot;pa_gain&quot;: 0, &quot;pwr_idx&quot;:  0},
                {&quot;rf_power&quot;: -3, &quot;pa_gain&quot;: 0, &quot;pwr_idx&quot;:  1},
                {&quot;rf_power&quot;:  0, &quot;pa_gain&quot;: 0, &quot;pwr_idx&quot;:  2},
                {&quot;rf_power&quot;:  3, &quot;pa_gain&quot;: 1, &quot;pwr_idx&quot;:  3},
                {&quot;rf_power&quot;:  6, &quot;pa_gain&quot;: 1, &quot;pwr_idx&quot;:  4},
                {&quot;rf_power&quot;: 10, &quot;pa_gain&quot;: 1, &quot;pwr_idx&quot;:  5},
                {&quot;rf_power&quot;: 11, &quot;pa_gain&quot;: 1, &quot;pwr_idx&quot;:  6},
                {&quot;rf_power&quot;: 12, &quot;pa_gain&quot;: 2, &quot;pwr_idx&quot;:  7},
                {&quot;rf_power&quot;: 13, &quot;pa_gain&quot;: 1, &quot;pwr_idx&quot;:  8},
                {&quot;rf_power&quot;: 14, &quot;pa_gain&quot;: 2, &quot;pwr_idx&quot;:  9},
                {&quot;rf_power&quot;: 16, &quot;pa_gain&quot;: 2, &quot;pwr_idx&quot;: 10},
                {&quot;rf_power&quot;: 20, &quot;pa_gain&quot;: 3, &quot;pwr_idx&quot;: 11},
                {&quot;rf_power&quot;: 23, &quot;pa_gain&quot;: 3, &quot;pwr_idx&quot;: 12},
                {&quot;rf_power&quot;: 25, &quot;pa_gain&quot;: 3, &quot;pwr_idx&quot;: 13},
                {&quot;rf_power&quot;: 26, &quot;pa_gain&quot;: 3, &quot;pwr_idx&quot;: 14},
                {&quot;rf_power&quot;: 27, &quot;pa_gain&quot;: 3, &quot;pwr_idx&quot;: 15}
            ]
        },
        &quot;radio_1&quot;: {
            &quot;enable&quot;: true,
            &quot;type&quot;: &quot;SX1250&quot;,
            &quot;single_input_mode&quot;: true,
            &quot;freq&quot;: 471400000,
            &quot;rssi_offset&quot;: -207.0,
            &quot;rssi_tcomp&quot;: {&quot;coeff_a&quot;: 0, &quot;coeff_b&quot;: 0, &quot;coeff_c&quot;: 20.41, &quot;coeff_d&quot;: 2162.56, &quot;coeff_e&quot;: 0},
            &quot;tx_enable&quot;: false //SELECTED RF_CHAIN IS DISABLED FOR TX ON SELECTED BOARD
        },
        //Receive 8 LoRa channels multi-data rates (SF5 ~ SF12 / 125 Simultaneously kHz) 
        &quot;chan_multiSF_0&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 0, &quot;if&quot;: -300000},
        &quot;chan_multiSF_1&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 0, &quot;if&quot;: -100000},
        &quot;chan_multiSF_2&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 0, &quot;if&quot;:  100000},
        &quot;chan_multiSF_3&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 0, &quot;if&quot;:  300000},
        &quot;chan_multiSF_4&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;: -300000},
        &quot;chan_multiSF_5&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;: -100000},
        &quot;chan_multiSF_6&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;:  100000},
        &quot;chan_multiSF_7&quot;: {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;:  300000},
        //2 mono-data rate (LoRa 250 / 500 kHz and FSK 50 kbps)
        &quot;chan_Lora_std&quot;:  {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;: -200000, &quot;bandwidth&quot;: 250000, &quot;spread_factor&quot;: 7,
                           &quot;implicit_hdr&quot;: false, &quot;implicit_payload_length&quot;: 17, &quot;implicit_crc_en&quot;: false, &quot;implicit_coderate&quot;: 1},
        &quot;chan_FSK&quot;:       {&quot;enable&quot;: true, &quot;radio&quot;: 1, &quot;if&quot;:  300000, &quot;bandwidth&quot;: 125000, &quot;datarate&quot;: 50000}
    },

    &quot;gateway_conf&quot;: { //gateway parameters
        &quot;gateway_ID&quot;: &quot;fffedca6320e9516&quot;,
        /* change with default server address/ports */
        &quot;server_address&quot;: &quot;loragw.things.qcloud.com&quot;,
        &quot;serv_port_up&quot;: 1700,
        &quot;serv_port_down&quot;: 1700,
        /* adjust the following parameters for your network */
        &quot;keepalive_interval&quot;: 10,
        &quot;stat_interval&quot;: 30,
        &quot;push_timeout_ms&quot;: 100,
        /* forward only valid packets */
        &quot;forward_crc_valid&quot;: true,
        &quot;forward_crc_error&quot;: false,
        &quot;forward_crc_disabled&quot;: false,
        /* Beaconing parameters */
        &quot;beacon_period&quot;: 0,
        &quot;beacon_freq_hz&quot;: 869525000,
        &quot;beacon_datarate&quot;: 9,
        &quot;beacon_bw_hz&quot;: 125000,
        &quot;beacon_power&quot;: 14,
        &quot;beacon_infodesc&quot;: 0
    },

    &quot;debug_conf&quot;: {
        &quot;ref_payload&quot;:[
            {&quot;id&quot;: &quot;0xCAFE1234&quot;},
            {&quot;id&quot;: &quot;0xCAFE2345&quot;}
        ],
        &quot;log_file&quot;: &quot;loragw_hal.log&quot;
    }
}
</code></pre>
<h1 id="2-dependancies">2 DEPENDANCIES</h1>
<h2 id="21-c-library-function">2.1 c library function</h2>
<pre><code class="language-cpp">#include &lt;stdint.h&gt;         /* C99 types */
#include &lt;stdbool.h&gt;        /* bool type */
#include &lt;stdio.h&gt;          /* printf, fprintf, snprintf, fopen, fputs */
#include &lt;inttypes.h&gt;       /* PRIx64, PRIu64... */

#include &lt;string.h&gt;         /* memset */
#include &lt;signal.h&gt;         /* sigaction */
#include &lt;time.h&gt;           /* time, clock_gettime, strftime, gmtime */
#include &lt;sys/time.h&gt;       /* timeval */
#include &lt;unistd.h&gt;         /* getopt, access */
#include &lt;stdlib.h&gt;         /* atoi, exit */
#include &lt;errno.h&gt;          /* error messages */
#include &lt;math.h&gt;           /* modf */

#include &lt;sys/socket.h&gt;     /* socket specific definitions */
#include &lt;netinet/in.h&gt;     /* INET constants and stuff */
#include &lt;arpa/inet.h&gt;      /* IP address conversion stuff */
#include &lt;netdb.h&gt;          /* gai_strerror */

#include &lt;pthread.h&gt;
</code></pre>
<h3 id="211-复杂函数">2.1.1 复杂函数</h3>
<h4 id="2111-thread">2.1.1.1 thread</h4>
<ol>
<li><a href="https://blog.csdn.net/yusiguyuan/article/details/40627775" target="_blank" rel="noopener"><code>pthread_mutex_lock() / pthread_mutex_unlock()</code></a>，注意每次使用时lock的pthread_mutex_t对象都不同</li>
<li><a href="https://ask.csdn.net/questions/267690?utm_medium=distribute.pc_relevant_t0.none-task-ask_topic-BlogCommendFromBaidu-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-ask_topic-BlogCommendFromBaidu-1.control" target="_blank" rel="noopener"><code>pthread_join()</code></a></li>
<li><a href="https://www.cnblogs.com/lijunamneg/archive/2013/01/25/2877211.html" target="_blank" rel="noopener"><code>phtread_cancel()</code></a></li>
<li>
<ul>
<li><a href="https://blog.csdn.net/zyex1108/article/details/45154211" target="_blank" rel="noopener"><code>time()</code></a></li>
<li><a href="https://www.runoob.com/cprogramming/c-function-gmtime.html" target="_blank" rel="noopener"><code>gtime()</code></a></li>
<li><a href="https://blog.csdn.net/SanQi_Abao/article/details/94964665" target="_blank" rel="noopener"><code>strftime()</code></a>：获得stat_timestamp：目前的格林威治时间</li>
<li><a href="https://blog.csdn.net/weixin_44880138/article/details/102605681" target="_blank" rel="noopener"><code>clock_gettime</code></a></li>
</ul>
</li>
</ol>
<h4 id="2112-socket">2.1.1.2 socket</h4>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/77023584" target="_blank" rel="noopener"><code>setsockopt()</code></a></li>
<li><a href="https://www.cnblogs.com/fnlingnzb-learner/p/8523206.html" target="_blank" rel="noopener"><code>recv()</code></a></li>
</ol>
<h4 id="2113-string">2.1.1.3 String</h4>
<ol>
<li><a href="https://baike.baidu.com/item/snprintf%28%29" target="_blank" rel="noopener"><code>snprintf()</code></a></li>
<li><a href="https://www.runoob.com/cprogramming/c-function-modf.html" target="_blank" rel="noopener"><code>modf()</code></a></li>
</ol>
<h4 id="2114-sequence">2.1.1.4 Sequence</h4>
<p><a href="https://blog.csdn.net/dwell548560/article/details/76187095" target="_blank" rel="noopener"><code>#if...#endif </code></a></p>
<h2 id="22-third-party-librarieslibtools">2.2 Third party libraries：libtools</h2>
<pre><code class="language-cpp">#include &quot;parson.h&quot;  //.. / libtools / src / parson.c
#include &quot;base64.h&quot; //.. / libtools / src / base64.c
</code></pre>
<h3 id="221-复杂函数">2.2.1 复杂函数</h3>
<p><a href="http://kgabis.github.io/parson/" target="_blank" rel="noopener">Parson library</a></p>
<h2 id="23-core-library-libloragw">2.3 Core library: libloragw</h2>
<blockquote>
<p>statically linked with the libloragw Lora concentrator library</p>
</blockquote>
<blockquote>
<p>The sx1302_hal is a host driver/HAL to build a Corecell reference design which communicates through SPI with a concentrator board based on Semtech SX1302 multi-channel modem and SX1250 RF transceivers</p>
</blockquote>
<pre><code class="language-cpp">#include &quot;loragw_hal.h&quot; //.. / libloragw / src / loragw_hal.c
#include &quot;loragw_aux.h&quot; //.. / libloragw / src / loragw_aux.c
#include &quot;loragw_reg.h&quot; //.. / libloragw / src / loragw_reg.c
#include &quot;loragw_gps.h&quot; //.. / libloragw / src / loragw_gps.c
</code></pre>
<h2 id="24-jitqueue">2.4 jitqueue</h2>
<pre><code class="language-cpp">#include &quot;jitqueue.h&quot; //.. / packet_forwarder / src / jitqueue.c
#include &quot;trace.h&quot; //.. / packet_forwarder / inc / trace.h
</code></pre>
<h2 id="25-注意">2.5 注意</h2>
<ol>
<li>.h文件介绍用法，.c文件介绍实现，都需要看</li>
<li>jit_*函数和lgw _*_*函数的用法：
<ul>
<li>a = function(b, &amp;c, &hellip;)
<ul>
<li>a：判断函数是否调用 (执行)成功的返回值</li>
<li>b：函数利用的变量</li>
<li>c：<em><strong>函数改变的/得到的变量</strong></em></li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="3-private-functions-and-threads">3 PRIVATE FUNCTIONS and threads</h1>
<h2 id="31-theory">3.1 Theory</h2>
<h3 id="311-main">3.1.1 main</h3>
<p><code>main</code>：</p>
<ol>
<li><code>usage</code>：<code>./lora_pkt_fwd -h</code></li>
<li><code>parse_SX130x_configuration</code></li>
<li><code>parse_gateway_configuration</code></li>
<li><code>parse_debug_configuration</code></li>
<li><code>sig_handler</code></li>
<li><code>5 threads</code></li>
</ol>
<p>作用：2~4显示固定内容，thread_up显示UPSTREAM json内容，main显示5 threads得到的统计内容，详见3.2节</p>
<hr>
<h3 id="312-5-threads">3.1.2 5 threads</h3>
<p>/* &mdash; THREAD 1: RECEIVING PACKETS AND FORWARDING THEM &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- */</p>
<p><code>thread_up</code>：</p>
<ol>
<li><code>sig_handler</code></li>
<li><code>difftimespec</code></li>
</ol>
<h2 id="lgw_receive接收数据包rxpkt并根据其属性构建upstream的datagram"><code>lgw_receive</code>接收数据包rxpkt，并根据其属性构建UPSTREAM的datagram</h2>
<p>/* &mdash; THREAD 2: POLLING SERVER AND ENQUEUING PACKETS IN JIT QUEUE &mdash;&mdash;&mdash;- */</p>
<p><code>thread_down</code>：</p>
<ol>
<li><code>sig_handler</code></li>
<li><code>difftimespec</code></li>
<li><code>crc16</code></li>
<li><code>get_tx_gain_lut_index</code> //jit_enqueue前查tx_gain_lut表</li>
<li><code>send_tx_ack</code>：gps_enabled与gps_ref_valid任意一个不满足都会发送JIT_ERROR_GPS_UNLOCKED，说明gps出问题统一用<strong>UNLOCKED</strong>代替</li>
</ol>
<ul>
<li>
<p><code>jit_init</code>：对应THREAD 2：thread_down</p>
</li>
<li>
<p><code>jit_enqueue</code>：对应THREAD 2：thread_down</p>
</li>
</ul>
<hr>
<p>/* &mdash; THREAD 3: CHECKING PACKETS TO BE SENT FROM JIT QUEUE AND SEND THEM &mdash; */</p>
<p><code>thread_jit</code>：</p>
<ol>
<li><code>sig_handler</code></li>
<li><code>print_tx_status</code></li>
</ol>
<ul>
<li>
<p><code>jit_peek</code>：对应THREAD 3：thread_jit</p>
</li>
<li>
<p><code>jit_dequeue</code>：对应THREAD 3：thread_jit</p>
</li>
<li>
<p><code>jit_queue_is_full/jit_queue_is_empty</code>：被上述四个函数调用的private functions</p>
</li>
</ul>
<h2 id="分析是从gateway到node的通信--just-in-time-downlink-schedulinghttpsgiteecomrejeeegw1302streemasterpacket_forwarder">分析：是从gateway到node的通信,  <a href="https://gitee.com/rejeee/gw1302s/tree/master/packet_forwarder" target="_blank" rel="noopener">Just-In-Time&rdquo; downlink scheduling</a></h2>
<p>/* &mdash; THREAD 4: PARSE GPS MESSAGE AND KEEP GATEWAY IN SYNC &mdash;&mdash;&mdash;&mdash;&mdash;&ndash; */</p>
<p><code>thread_gps</code>：</p>
<ol>
<li><code>gps_process_sync</code>：time_reference_gps；具体的GPS &lt;-&gt; timestamp TIME REFERENCE</li>
<li><code>gps_process_coords</code></li>
</ol>
<hr>
<p>/* &mdash; THREAD 5: CHECK TIME REFERENCE AND CALCULATE XTAL CORRECTION &mdash;&mdash;&mdash; */</p>
<p><code>thread_valid</code>：</p>
<ol>
<li><code>sig_handler</code></li>
<li>变量控制</li>
</ol>
<ul>
<li>TIME REFERENCE：gps_ref_valid；用于判断是否启用TIME REFERENCE</li>
<li>XTAL CORRECTION：
<ul>
<li>xtal_correct_ok</li>
<li>xtal_correct</li>
</ul>
</li>
</ul>
<hr>
<h2 id="32-empirical-experiment">3.2 Empirical experiment</h2>
<pre><code class="language-cpp">//main(): display version informations
*** Packet Forwarder ***
Version: 1.0.5
*** SX1302 HAL library version info ***
Version: 1.0.5;
***
//main(): display host endianness
INFO: Little endian host
INFO: found configuration file global_conf.json, parsing it

//parse_SX130x_configuration(): point to the gateway configuration object
INFO: global_conf.json does contain a JSON object named SX130x_conf, parsing SX1302 parameters
INFO: spidev_path /dev/spidev0.0, lorawan_public 1, clksrc 0, full_duplex 0
INFO: antenna_gain 0 dBi
INFO: Configuring legacy timestamp
INFO: Configuring Tx Gain LUT for rf_chain 0 with 16 indexes for sx1250
INFO: radio 0 enabled (type SX1250), center frequency 471400000, RSSI offset -207.000000, tx enabled 1, single input mode 1
INFO: radio 1 enabled (type SX1250), center frequency 475000000, RSSI offset -207.000000, tx enabled 0, single input mode 1
INFO: Lora multi-SF channel 0&gt;  radio 0, IF -300000 Hz, 125 kHz bw, SF 5 to 12 //Rb与Rs都由SF和BW决定
INFO: Lora multi-SF channel 1&gt;  radio 0, IF -100000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 2&gt;  radio 0, IF 100000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 3&gt;  radio 0, IF 300000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 4&gt;  radio 1, IF -300000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 5&gt;  radio 1, IF -100000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 6&gt;  radio 1, IF 100000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora multi-SF channel 7&gt;  radio 1, IF 300000 Hz, 125 kHz bw, SF 5 to 12
INFO: Lora std channel&gt; radio 1, IF -200000 Hz, 250000 Hz bw, SF 7, Explicit header
INFO: FSK channel&gt; radio 1, IF 300000 Hz, 125000 Hz bw, 50000 bps datarate //Rb (bps = bit/s);

//parse_gateway_configuration(): point to the gateway configuration object
INFO: global_conf.json does contain a JSON object named gateway_conf, parsing gateway parameters
INFO: gateway MAC address is configured to 0016C001FF10D3F6
INFO: server hostname or IP address is configured to &quot;47.110.36.225&quot;
INFO: upstream port is configured to &quot;1700&quot;
INFO: downstream port is configured to &quot;1700&quot;
INFO: downstream keep-alive interval is configured to 10 seconds
INFO: statistics display interval is configured to 30 seconds
INFO: upstream PUSH_DATA time-out is configured to 100 ms
INFO: packets received with a valid CRC will be forwarded
INFO: packets received with a CRC error will NOT be forwarded
INFO: packets received with no CRC will NOT be forwarded
INFO: Beaconing period is configured to 0 seconds //disable class B beacon
INFO: Beaconing signal will be emitted at 869525000 Hz
INFO: Beaconing datarate is set to SF9
INFO: Beaconing modulation bandwidth is set to 125000Hz
INFO: Beaconing TX power is set to 14dBm
INFO: Beaconing information descriptor is set to 0

//parse_debug_configuration(): point to the gateway configuration object
INFO: global_conf.json does contain a JSON object named debug_conf, parsing debug parameters
INFO: got 2 debug reference payload
INFO: reference payload ID 0 is 0xCAFE1234
INFO: reference payload ID 1 is 0xCAFE2345
INFO: setting debug log file name to loragw_hal.log

//main(): Board reset
CoreCell reset through GPIO7...

//?
INFO: Configuring SX1250_0 in single input mode
INFO: Configuring SX1250_1 in single input mode

//main(): starting the concentrator
INFO: [main] concentrator started, packet can now be received
INFO: concentrator EUI: 0x0016c001ff10d3f6
</code></pre>
<hr>
<pre><code class="language-cpp">
INFO: Received pkt from mote: 1350200C (fcnt=13)

//thread_up(): start of JSON structure
JSON up: {&quot;rxpk&quot;:[{&quot;jver&quot;:1,&quot;tmst&quot;:137795171,&quot;chan&quot;:4,&quot;rfch&quot;:1,&quot;freq&quot;:475.100000,&quot;mid&quot;:0,&quot;stat&quot;:1,&quot;modu&quot;:&quot;LORA&quot;,&quot;datr&quot;:&quot;SF12Bw125&quot;,&quot;codr&quot;:&quot;4/5&quot;,&quot;rssis&quot;:-84,&quot;lsnr&quot;:-5.0,&quot;foff&quot;:786,&quot;rssi&quot;:-80,&quot;size&quot;:13,&quot;data&quot;:&quot;gQwgUBMADQANAKvN7w==&quot;}]} //datr由SF、Bw计算得

INFO: [up] PUSH_ACK received in 40ms
INFO: [down] PULL_ACK received in 34ms

//main(): display a report
##### 2020-10-18 10:49:51 GMT #####

### [UPSTREAM] ###
# RF packets received by concentrator: 1 //thread_up
# CRC_OK: 100.00%, CRC_FAIL: 0.00%, NO_CRC: 0.00% //thread_up
# RF packets forwarded: 1 (13 bytes) //thread_up(thread_up)
# PUSH_DATA datagrams sent: 2 (360 bytes) //PUSH_DATA：thread_up(thread_up)
# PUSH_DATA acknowledeged: 100.00% //PUSH_ACK：thread_up

### [DOWNSTREAM] ###
# PULL_DATA sent: 3 (100.00%) //PULL_DATA(PULL_ACK)：thread_down
# PULL_RESP(onse) datagrams received: 0 (0 bytes) //PULL_RESP：thread_down(thread_down)
# RF packets sent to concentrator: 0 (0 bytes) //thread_jit发送jit里的downlink packet(thread_down)
/*sent = ok + error*/
# TX errors: 0 //RF packets sent to concentrator失败的
if (cp_nb_tx_requested != 0 ) //thread_down根据PULL_RESP得到的downlink_type使得packet enqueue jit
# TX rejected... //TX_ACK：packet enqueue失败的；send_tx_ack发送具体错误


### SX1302 Status ###
# SX1302 counter (INST): 150921885
# SX1302 counter (PPS): 0
# BEACON queued: 0 //thread_down根据JIT_PKT_TYPE_BEACON使得beacon enqueue jit
# BEACON sent so far: 0 //RF packets sent to concentrator对应的
# BEACON rejected: 0 //BEACON queued失败的

### [JIT] ### //jit = RF chains
src/jitqueue.c:442:jit_print_queue(): INFO: [jit] queue is empty //thread_down：已经enqueue jit[0]里的beacon和packet
#--------
src/jitqueue.c:442:jit_print_queue(): INFO: [jit] queue is empty //thread_down:已经enqueue jit[1]里的beacon和packet

### [GPS] ###
# GPS sync is disabled
### Concentrator temperature 0 C ###
##### END #####
</code></pre>
<pre><code class="language-cpp">/*main()生成： generate a JSON report (will be sent to server by upstream thread)
thread_up()发送：add status report if a new one is available ('status report': &quot;stat&quot; object)
其实本来和上面的rxpt对象同属于一个json，“同时发送显示”；但是因为程序运行顺序原因“同时发送不同时显示”了
*/
JSON up: {&quot;stat&quot;:{&quot;time&quot;:&quot;2020-10-18 10:49:51 GMT&quot;,&quot;rxnb&quot;:1,&quot;rxok&quot;:1,&quot;rxfw&quot;:1,&quot;ackr&quot;:100.0,&quot;dwnb&quot;:0,&quot;txnb&quot;:0,&quot;temp&quot;:0.0}}

INFO: [up] PUSH_ACK received in 34ms
INFO: [down] PULL_ACK received in 35ms
INFO: [down] PULL_ACK received in 37ms
</code></pre>
<hr>
<pre><code class="language-cpp">//thread_up()
INFO: End of upstream thread

//main(): if an exit signal was received, try to quit properly + Board reset
INFO: concentrator stopped successfully
CoreCell reset through GPIO7...
INFO: Exiting packet forwarder program
</code></pre>
<h2 id="33-basic-communication-protocol-between-lora-gateway-and-network-server">3.3 Basic communication protocol between LoRa gateway and Network Server</h2>
<blockquote>
<p>可查的最详细的相关资料</p>
</blockquote>
<ol>
<li><a href="https://gitee.com/rejeee/gw1302s/blob/master/packet_forwarder/PROTOCOL.md" target="_blank" rel="noopener">PROTOCOL</a></li>
<li><a href="https://onedrive.gimhoy.com/sharepoint/aHR0cHM6Ly9zZXVlZHVjbjEtbXkuc2hhcmVwb2ludC5jb20vOmI6L2cvcGVyc29uYWwvMjIwMjA0NjAxX3NldV9lZHVfY24vRVJ4VTcxc1RCNFJEaFhVU0RUTXlXdU1CNHc1NHQyZ3JhT3NvdUpVckszYkt0dz9lPUVoWXBMdw==.mp3" target="_blank" rel="noopener">LoRaWAN Network Server Demonstration:
Gateway to Server Interface Definition</a></li>
<li><a href="https://onedrive.gimhoy.com/sharepoint/aHR0cHM6Ly9zZXVlZHVjbjEtbXkuc2hhcmVwb2ludC5jb20vOmI6L2cvcGVyc29uYWwvMjIwMjA0NjAxX3NldV9lZHVfY24vRVJXaXJLdnJiVEZPaS1xUGk3OFFfVTRCUm4tM1dwLXVwNTNLdVJ6ZE9leDllZz9lPXR6OWh3eA==.mp3" target="_blank" rel="noopener">剖析 LoRaWAN Gateway 核心代码</a></li>
<li><a href="https://www.cnblogs.com/answerinthewind/p/13154904.html" target="_blank" rel="noopener">global_conf.json参数含义</a></li>
<li>[PROTOCOL相关]https://blog.csdn.net/m0_38008027/article/details/89086175</li>
</ol>
<h3 id="331-upstream-protocol">3.3.1 UPstream protocol</h3>
<ol>
<li>PUSH_DATA packet：thread_up</li>
<li>PUSH_ACK packet：thread_up</li>
</ol>
<h3 id="332-downstream-protocol">3.3.2 Downstream protocol</h3>
<ol>
<li>
<p>PULL_DATA packet：thread_down</p>
</li>
<li>
<p>PULL_ACK packet：thread_down</p>
</li>
<li>
<p>PULL_RESP packet：thread_down</p>
<p>prase这些packet的json分辨downlink packet class，决定发射时间（与beacon无关）</p>
<ul>
<li>Class C：imme (immediately)</li>
<li>Class A：tmst (timestamp)，一般不采用：因为global.config中gps_tty_path与beacon_period的设置</li>
<li>Class B：tmms (GPS time -&gt; timestamp)</li>
</ul>
<p>根据数据包类型将其<code>jit_enqueue</code>到jit_queue</p>
</li>
<li>
<p>TX_ACK packet：thread_down</p>
</li>
</ol>
<h1 id="4-compile-install-and-run-instructions">4 Compile, install and run instructions</h1>
<p>在<strong>gw1302s</strong>执行<code>make clean all</code>，调用所有helper program的make clean，即Clean and compile everything</p>
<p>再执行<code>make install</code>，调用所有helper program的make install，把可执行程序都<code>scp</code>到gw1302s/bin中</p>
<h1 id="5-硬件">5 硬件</h1>
<h2 id="51-组成">5.1 组成</h2>
<ol>
<li>multi-channel SX1302 baseband IC</li>
<li>two SX1250 RF transceivers</li>
</ol>
<p>这与global.config中的&quot;SX130x_conf&quot;紧密相关：<a href="https://gitee.com/rejeee/gw1302s/tree/master/packet_forwarder" target="_blank" rel="noopener">&ldquo;SX130x_conf&rdquo; that should contain the parameters for the Lora concentrator board (RF channels definition, modem parameters, etc) </a></p>
<h2 id="52-concentrator">5.2 Concentrator</h2>
<p><a href="https://semtech.my.salesforce.com/sfc/p/#E0000000JelG/a/2R000000HV3G/an5Oh4KfiY7tAO1MO7RiPOj08WUpOTjPHSF57_.NlJ0" target="_blank" rel="noopener">Adobe PDFCorecell_Reference_Design_User_Guide；参考设计</a></p>
<ol>
<li>The SX1302 digital baseband chip is a highly innovative digital signal processing engine
equipped with 16 modulators, capable of demodulating 64 combinations of LoRa packets,
and 2 separate modulators</li>
<li>The SX1250 is a highly integrated RF to IQ transceiver capable of supporting multiple
modulation schemes over the 150-960 MHz ISM frequency bands.</li>
<li>One SX1302 and two SX1250 transceivers are used to complete an eight channel LoRa
concentrator.</li>
</ol>
<h2 id="53-与程序的关系">5.3 与程序的关系</h2>
<p>thread_jit入队出队的队列正是两个SX1250对应的radio_0、radio_1</p>
<h1 id="6-问题">6 问题</h1>
<ul>
<li><input disabled="" type="checkbox"> 温度相关</li>
<li><input disabled="" type="checkbox"> RF packets forwarded比PUSH_DATA datagrams sent少</li>
<li><input disabled="" type="checkbox"> DEPENDANCIES相关的函数定义及实现</li>
<li><input disabled="" type="checkbox"> &ldquo;SX130x_conf&quot;相关，如RF chain、IF chain等参数</li>
</ul>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/wireless-communication/">Wireless Communication</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://haowong.com/project/codereview/&amp;text=Code%20Review%20of%20Helper%20programs%20&amp;#39;LoRa_PKT_FWD&amp;#39;" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://haowong.com/project/codereview/&amp;t=Code%20Review%20of%20Helper%20programs%20&amp;#39;LoRa_PKT_FWD&amp;#39;" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Code%20Review%20of%20Helper%20programs%20&amp;#39;LoRa_PKT_FWD&amp;#39;&amp;body=https://haowong.com/project/codereview/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://haowong.com/project/codereview/&amp;title=Code%20Review%20of%20Helper%20programs%20&amp;#39;LoRa_PKT_FWD&amp;#39;" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://haowong.com/project/codereview/&amp;title=Code%20Review%20of%20Helper%20programs%20&amp;#39;LoRa_PKT_FWD&amp;#39;" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://haowong.com/"><img class="avatar mr-3 avatar-circle" src="/author/haowong/avatar_huc2a8063aa4399eb4d97483d10e337980_66269_270x270_fill_q90_lanczos_center.JPG" alt="HaoWong"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://haowong.com/">HaoWong</a></h5>
      <h6 class="card-subtitle">Master Candidate</h6>
      <p class="card-text">Enjoy your reading</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:haowong@seu.edu.cn" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/wong-hao" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/" >
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/" >
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://arxiv.org/set_author_id" target="_blank" rel="noopener">
        <i class="ai ai-arxiv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "hugoblog-6" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>








  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/project/internal-project/">LoRa and LoRaWAN</a></li>
      
      <li><a href="/project/external-project/">External Project</a></li>
      
    </ul>
  </div>
  





    <div class="project-related-pages content-widget-hr">
      
      

      
      
      

      
      
      

      
      
      
    </div>
  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://hugoblog-6.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/wowchemy.min.4c2bca31150ce93c5a5e43b8a50f22fd.js"></script>

    

<center>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次<br>
</span>
<span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次<br>
</span>
</center>


<center>
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>  
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("07/19/2020 13:14:21");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</center>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-7HJ175Y3TY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7HJ175Y3TY');
</script>


<center>
    <script type="text/javascript" src="//rf.revolvermaps.com/0/0/1.js?i=5k01kpl1ga8&amp;s=220&amp;m=7&amp;v=true&amp;r=false&amp;b=000000&amp;n=false&amp;c=ff0000" async="async"></script>
</center>




  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Father</a>
    
    
  </p>
  

  <p class="powered-by">
    ©
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy</a>  —
    the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">
    open source</a> website builder that empowers creators.
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
